<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive Word Cloud</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.1.1/src/wordcloud2.min.js"></script>
  <style>
    :root {
      --social: #ff6b6b;
      --addiction: #4dabf7;
      --students: #38d9a9;
    }

    body {
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
      background: #f9f9f9;
      color: #333;
    }

    h1 {
      text-align: center;
    }

    main {
      max-width: 1200px;
      margin: auto;
      text-align: center;
    }

    .filter-controls {
      margin: 20px 0;
    }

    label {
      font-weight: bold;
      margin-right: 8px;
    }

    select {
      padding: 6px 10px;
      font-size: 16px;
    }

    .cloud-container {
      position: relative;
      height: 400px;
      width: 100%;
      background-color: rgba(0, 0, 0, 0.05);
      margin: 20px 0;
      border-radius: 12px;
    }

    .slider-container {
      margin: 20px 0;
    }

    .slider-container input {
      width: 100%;
      margin: 10px 0;
    }

    canvas {
      width: 100% !important;
      height: 100% !important;
      display: block;
    }

    @media (max-width: 768px) {
      .slider-container input {
        width: 80%;
        margin: auto;
      }
    }
  </style>
</head>
<body>

<main role="main">
  <h1>Interactive Word Cloud</h1>

  <section class="filter-controls">
    <label for="filter">Filter by keyword group:</label>
    <select id="filter" aria-controls="word-cloud" aria-label="Select keyword group">
      <option value="all">Show All</option>
      <option value="social">Social Media</option>
      <option value="addiction">Addiction</option>
      <option value="students">University Students</option>
    </select>
  </section>

  <section class="cloud-container">
    <canvas id="word-cloud" aria-label="Word Cloud"></canvas>
  </section>

  <section class="slider-container">
    <label for="slider-breadth">Breadth: </label>
    <input type="range" id="slider-breadth" min="0" max="100" value="50" aria-label="Adjust breadth from broader to narrower terms" />
    <br>
    <span id="breadth-label" role="status" aria-live="polite">Moderate Breadth (Both Broader and Narrower Terms)</span>
  </section>
</main>

<script>
  const colors = {
    social: 'var(--social)',
    addiction: 'var(--addiction)',
    students: 'var(--students)'
  };

  const wordGroups = {
    social: {
      broader: [['online', 25], ['digital life', 20], ['communication', 18]],
      focus: [['social media', 40]],
      narrower: [['Instagram', 28], ['TikTok', 24], ['likes & validation', 18], ['group chats', 16]],
    },
    addiction: {
      broader: [['negative effects', 22], ['technology', 20], ['media exposure', 18]],
      focus: [['addiction', 35]],
      narrower: [['compulsive behaviour', 22], ['doomscrolling', 20]],
    },
    students: {
      broader: [['young people', 24], ['information age', 16]],
      focus: [['university students', 30]],
      narrower: [['first year undergraduates', 18], ['peer influence', 20], ['screen time', 22], ['mental health', 25]],
    }
  };

  let currentFilter = 'all';
  let breadth = 50;  // Default breadth (middle)

  // Function to render the word cloud based on breadth
  function renderCloud(targetId, dataGroup, filter, breadth) {
    const wordList = [];

    // Determine which terms should appear based on the slider's position
    if (breadth <= 33) {
      // Show only broader terms
      if (filter === 'all' || filter === 'social') wordList.push(...dataGroup.social.broader);
      if (filter === 'all' || filter === 'addiction') wordList.push(...dataGroup.addiction.broader);
      if (filter === 'all' || filter === 'students') wordList.push(...dataGroup.students.broader);
    } else if (breadth >= 67) {
      // Show only narrower terms
      if (filter === 'all' || filter === 'social') wordList.push(...dataGroup.social.narrower);
      if (filter === 'all' || filter === 'addiction') wordList.push(...dataGroup.addiction.narrower);
      if (filter === 'all' || filter === 'students') wordList.push(...dataGroup.students.narrower);
    } else {
      // Show only focus terms (the starter keywords)
      if (filter === 'all' || filter === 'social') wordList.push(...dataGroup.social.focus);
      if (filter === 'all' || filter === 'addiction') wordList.push(...dataGroup.addiction.focus);
      if (filter === 'all' || filter === 'students') wordList.push(...dataGroup.students.focus);
    }

    // Map words to color
    const coloredWordList = wordList.map(([word, weight]) => {
      let color = '';
      if (word === 'social media') color = colors.social;
      else if (word === 'addiction') color = colors.addiction;
      else if (word === 'university students') color = colors.students;
      return [word, weight, color];
    });

    // Render the cloud
    WordCloud(document.getElementById(targetId), {
      list: coloredWordList,
      gridSize: 8,
      weightFactor: breadth / 10,  // Adjust word size based on breadth slider
      color: (word, weight) => {
        const entry = coloredWordList.find(item => item[0] === word);
        return entry ? entry[2] : '#000';
      },
      backgroundColor: 'transparent',
      drawOutOfBound: false,
      minSize: 10,
      maxSize: 100,
      hover: (event, word, item) => {
        item.style.fontWeight = 'bold';
      },
      drawMask: true,
      rotationSteps: 2,
      opacityThreshold: 0.8, // Keep words opaque enough
    });
  }

  // Function to render all clouds
  function renderAll(filter = 'all', breadth = 50) {
    renderCloud('word-cloud', wordGroups, filter, breadth);
  }

  // Initial render
  renderAll();

  // Filter word cloud based on selection
  document.getElementById('filter').addEventListener('change', (e) => {
    currentFilter = e.target.value;
    renderAll(currentFilter, breadth);
  });

  // Handle breadth slider change
  document.getElementById('slider-breadth').addEventListener('input', (e) => {
    breadth = e.target.value;
    document.getElementById('breadth-label').textContent = breadth <= 33 ? 'Broader Terms' : breadth >= 67 ? 'Narrower Terms' : 'Moderate Breadth (Both Broader and Narrower Terms)';
    renderAll(currentFilter, breadth);
  });
</script>

</body>
</html>
